<main class="main" style="display: flex; flex-direction: column; padding: 0; margin: 0; height: 100%; padding: 1rem;">
    <app-header></app-header>

    <!-- Pantalla de carga inicial -->
    <div *ngIf="isLoading && !hasError" class="loading-container">
        <span class="loader"></span>
    </div>

    <!-- Pantalla de error -->
    <div *ngIf="hasError" id="errorDisplay" class="errorDisplay">
        <section class="error-message">
            <span class="error-icon">⚠</span>
            <div class="error-content">
                <strong>Error de carga de contenido</strong>
                <p>{{ errorMessage }}</p>
            </div>
        </section>
    </div>

    <!-- Contenido principal -->
    <ng-container *ngIf="!isLoading && !hasError">

        <!-- Stats Grid (solo se actualiza cuando cambian) -->
        <div class="stats-grid" *ngIf="stats">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Total Contenidos</h4>
                    <div class="card-value">{{ stats.total }}</div>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Videos</h4>
                    <div class="card-value text-blue">{{ stats.videos }}</div>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Imágenes</h4>
                    <div class="card-value text-green">{{ stats.imagenes }}</div>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h4 class="card-title width-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" x2="2" y1="12" y2="12"></line>
                            <path
                                d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z">
                            </path>
                            <line x1="6" x2="6.01" y1="16" y2="16"></line>
                            <line x1="10" x2="10.01" y1="16" y2="16"></line>
                        </svg>
                        Almacenamiento
                    </h4>
                    <div class="storage-content">
                        <div class="storage-value">
                            <span class="storage-number">{{ stats.storage.formatted }}</span>
                            <span class="storage-total">usados</span>
                        </div>
                        <div role="progress-bar" aria-valuemin="0" aria-valuemax="100" class="progress-bar">
                            <div class="progress-fill"
                                [style.width.%]="(stats.storage.bytes / (10 * 1024 * 1024 * 1024)) * 100">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Buscador y Filtros (siempre visibles, no se recargan) -->
        <div class="card search-card">
            <div class="card-content">
                <div class="search-panel">
                    <div class="search-row">
                        <div class="search-input-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="icon search-icon">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.3-4.3"></path>
                            </svg>
                            <input type="text" class="search-input" placeholder="Buscar por nombre de archivo..."
                                [(ngModel)]="searchTerm" (input)="onSearchChange()" />
                        </div>

                        <select class="select" [(ngModel)]="selectedType" (change)="onTypeChange()">
                            <option value="">Todos los tipos</option>
                            <option value="video">Videos</option>
                            <option value="imagen">Imágenes</option>
                            <option value="audio">Audio</option>
                            <option value="documento">Documentos</option>
                            <option value="otro">Otros</option>
                        </select>

                        <button (click)="openModal()" class="button button-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" x2="12" y1="3" y2="15"></line>
                            </svg>
                            Subir Contenido
                        </button>
                    </div>

                    <div class="sort-row">
                        <div class="sort-label">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="icon">
                                <line x1="21" x2="14" y1="4" y2="4"></line>
                                <line x1="10" x2="3" y1="4" y2="4"></line>
                                <line x1="21" x2="12" y1="12" y2="12"></line>
                                <line x1="8" x2="3" y1="12" y2="12"></line>
                                <line x1="21" x2="16" y1="20" y2="20"></line>
                                <line x1="12" x2="3" y1="20" y2="20"></line>
                                <line x1="14" x2="14" y1="2" y2="6"></line>
                                <line x1="8" x2="8" y1="10" y2="14"></line>
                                <line x1="16" x2="16" y1="18" y2="22"></line>
                            </svg>
                            <span>Ordenar por:</span>
                        </div>
                        <select class="select" [(ngModel)]="selectedSort" (ngModelChange)="onSortChange()">
                            <option value="masReciente">Más Reciente</option>
                            <option value="masAntiguo">Más Antiguo</option>
                            <option value="nombreAZ">Nombre (A-Z)</option>
                            <option value="nombreZA">Nombre (Z-A)</option>
                            <option value="mayorTamano">Mayor tamaño</option>
                            <option value="menorTamano">Menor Tamaño</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grid de archivos (solo este componente se actualiza) -->
        <app-file-grid [searchTerm]="searchTerm" [selectedType]="selectedType" [selectedSort]="selectedSort"
            (openModal)="openModal()" (statsChanged)="refreshStats()">
        </app-file-grid>

    </ng-container>

    <!-- Modal -->
    <app-modal [isVisible]="isModalVisible" (close)="closeModal()"></app-modal>
</main>